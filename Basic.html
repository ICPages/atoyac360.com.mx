<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title id="titulo"></title>
  <link rel="icon" type="image/png" href="Atoyac360.webp">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bad+Script&family=Science+Gothic:wght@100..900&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container">
            <a class="navbar-brand fw-bold science-gothic" href="index.html">Atoyac 360</a>
        </div>
    </nav>

<!-- MAIN -->
  <main class="container">
    <h2 class="fw-bold bad-script-regular" id="nombre"></h2>
    <div class="row g-4">
      <div class="col-md-4">
        <img id="imagen" class="img-fluid rounded shadow" alt="Logo">
        <p></p>
        <h5 class="fw-bold">Contacto:</h5>
        <p id="contacto" class="redes"></p>
        <div id="bloque-horario">
      <h5 class="fw-bold">Horario</h5>
      <p id="horario"></p></div>
        <p><a href="#" id="menu" download class="descargarmenu"><i class="bi bi-download"></i> Descargar Menú</a></p>
      </div>
      <div class="col-md-8">
        <p id="deslarga"></p>
        <div class="mt-4">
            <h5 class="fw-bold">Ubicación</h5>
            <div id="sucursal1-container">
              <h6 id="sucursal1-titulo"></h6>
              <iframe id="mapa1" width="100%" height="250" class="rounded border"></iframe>
            </div>
            <div id="sucursal2-container">
              <h6 id="sucursal2-titulo"></h6>
              <iframe id="mapa2" width="100%" height="250" class="rounded border"></iframe>
            </div>
          </div>
        <p></p>
      </div>
    </div>
  </main>

    <!-- FOOTER -->
    <footer class="custom-footer py-5">
        <div class="container">
            <div class="row">

                <div class="col-md-2 mb-3 text-center">
                    <img src="Atoyac360.webp" alt="Atoyac 360" class="img-fluid" style="max-height: 120px;">
                </div>

                <div class="col-md-4 mb-3">
                    <h5 class="science-gothic">Atoyac 360</h5>
                    <p>Directorio local de negocios y servicios en Atoyac de Álvarez, Guerrero y sus alrededores.</p>
                </div>

                <div class="col-md-3 mb-3">
                    <h6>Enlaces</h6>
                    <ul class="list-unstyled">
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="planesAtoyac360.html">Planes de Atoyac 360</a></li>
                        <li><a href="politicasAtoyac360.html">Políticas de Atoyac 360</a></li>
                        <li><a href="https://es.wikipedia.org/wiki/Atoyac_de_%C3%81lvarez">Sobre Atoyac de Álvarez</a></li>
                    </ul>
                </div>

                <div class="col-md-3 mb-3">
                <h6>Contacto</h6>
                <p class="m-0">
                    <a href="https://www.facebook.com/share/1CyofTsBCq/" target="_blank"><i class="bi bi-facebook"></i> Facebook</a>
                </p>
                <p class="m-0">
                    <a href="https://wa.me/522221106016?text=%C2%A1Hola%20*Atoyac%20360*%21%20Me%20gustar%C3%ADa%20recibir%20informaci%C3%B3n%20sobre%3A"
                       target="_blank"><i class="bi bi-whatsapp"></i> WhatsApp</a>
                </p>
            </div>

            </div>

            <div class="text-center mt-3">© 2026 Atoyac 360. Página desarrollada por IC Pages.</div>
        </div>
    </footer>

  <!-- Firebase SDK Modular -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import { getFirestore, doc, getDoc, runTransaction } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
    const firebaseConfig = {
      apiKey: "AIzaSyD579Z21DvWp9jabiNewT22O-Sk_8G_sQY",
      authDomain: "atoyac360.firebaseapp.com",
      projectId: "atoyac360",
      storageBucket: "atoyac360.firebasestorage.app",
      messagingSenderId: "1004338612408",
      appId: "1:1004338612408:web:bbe17ed5b57e66d2194c4d",
      measurementId: "G-0T4X5N476S"
    };
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);
    const stars = document.querySelectorAll("#rating .star");
    const ratingValue = document.getElementById("rating-value");
    let currentRating = 0;
    const itemId = "planbasic";
    const docRef = doc(db, "calificaciones", itemId);
    function highlightStars(rating) {
      stars.forEach(star => {
        star.textContent = parseInt(star.dataset.value) <= Math.round(rating) ? '★' : '☆';
      });
    }
    // Cargar promedio desde Firebase
    getDoc(docRef).then(docSnap => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        currentRating = data.promedio || 0;
        ratingValue.textContent = `(${currentRating.toFixed(1)})`;
        highlightStars(currentRating);
      } else {
        currentRating = 0;
        ratingValue.textContent = `(0.0)`;
        highlightStars(currentRating);
      }
    });
    // Eventos de clic
    stars.forEach(star => {
      star.addEventListener("mouseover", () => highlightStars(parseInt(star.dataset.value)));
      star.addEventListener("mouseout", () => highlightStars(currentRating));
      star.addEventListener("click", async () => {
        const rating = parseInt(star.dataset.value);
        try {
          await runTransaction(db, async (transaction) => {
            const docSnap = await transaction.get(docRef);
            if (!docSnap.exists()) {
              transaction.set(docRef, { promedio: rating, votos: 1 });
            } else {
              const data = docSnap.data();
              const votos = data.votos || 0;
              const promedio = data.promedio || 0;
              const nuevoPromedio = ((promedio * votos) + rating) / (votos + 1);
              transaction.update(docRef, { promedio: nuevoPromedio, votos: votos + 1 });
            }
          });
          currentRating = rating;
          ratingValue.textContent = `(${currentRating.toFixed(1)})`;
          highlightStars(currentRating);
        } catch (e) {
          console.error("Error actualizando calificación:", e);
        }
      });
    });
  </script>

<!-- CARGA AUTOMÁTICA DESDE JSON -->
<script>
async function cargarNegocio() {
  const params = new URLSearchParams(window.location.search);
  const id = parseInt(params.get("id"));
  if (!id) return;

  const resp = await fetch("negocios.json");
  const negocios = await resp.json();
  const negocio = negocios.find(n => n.id === id);
  if (!negocio) return;

  const limpio = x => x ? x.toString().replace(/\s+/g, "") : "";
  const existe = x => x !== null && x !== undefined && String(x).trim() !== "";

  // ---------- Datos principales ----------
  document.getElementById("titulo").textContent = negocio.nombre ?? "";
  document.getElementById("nombre").textContent = negocio.nombre ?? "";
  document.getElementById("deslarga").innerHTML = negocio.deslarga ?? negocio.descorta ?? "";
  if (existe(negocio.imagen)) document.getElementById("imagen").src = negocio.imagen;

  // ---------- Contactos ----------
  let contactoHTML = "";
  const suc1 = existe(negocio.sucursal1), suc2 = existe(negocio.sucursal2);

  // Función para generar íconos de contacto
  const contactoIcono = (tipo, valor) => {
    switch(tipo) {
      case "tel": return `<i class="bi bi-telephone-fill"></i> ${valor}`;
      case "whatsapp": return `<i class="bi bi-whatsapp"></i> ${valor}`;
      case "facebook": return `<i class="bi bi-facebook"></i> ${valor}`;
      case "instagram": return `<i class="bi bi-instagram"></i> ${valor}`;
      case "tiktok": return `<i class="bi bi-tiktok"></i> ${valor}`;
      case "web": return `<i class="bi bi-globe"></i> ${valor}`;
      default: return valor;
    }
  };

  // Sucursal 1
  if(suc1) contactoHTML += `<h6 class="mt-2">${negocio.sucursal1}</h6>`;
  [negocio.llamadas1, negocio.llamadas2].forEach(num => { 
    if(existe(num)) contactoHTML += `<a href="tel:${limpio(num)}">${contactoIcono("tel", num)}</a><br>`; 
  });
  [negocio.whatsapp1, negocio.whatsapp2].forEach(num => { 
    if(existe(num)) contactoHTML += `<a href="https://wa.me/${limpio(num)}" target="_blank" rel="noopener">${contactoIcono("whatsapp", num)}</a><br>`; 
  });
  if(existe(negocio.facebook1)) contactoHTML += `<a href="https://facebook.com/${negocio.facebook1}" target="_blank">${contactoIcono("facebook", "Facebook")}</a><br>`;
  if(existe(negocio.instagram1)) contactoHTML += `<a href="https://instagram.com/${negocio.instagram1}" target="_blank">${contactoIcono("instagram", "Instagram")}</a><br>`;
  if(existe(negocio.tiktok1)) contactoHTML += `<a href="https://tiktok.com/@${negocio.tiktok1}" target="_blank">${contactoIcono("tiktok", "TikTok")}</a><br>`;
  if(existe(negocio.web1)) contactoHTML += `<a href="${negocio.web1}" target="_blank">${contactoIcono("web", negocio.web_text1 ?? negocio.web1)}</a><br>`;

  // Sucursal 2
  const anySuc2 = [negocio.llamadas3, negocio.llamadas4, negocio.whatsapp3, negocio.whatsapp4, negocio.facebook2, negocio.instagram2, negocio.tiktok2, negocio.web2].some(existe);
  if(suc2 && anySuc2) contactoHTML += `<h6 class="mt-3">${negocio.sucursal2}</h6>`;
  [negocio.llamadas3, negocio.llamadas4].forEach(num => { 
    if(existe(num)) contactoHTML += `<a href="tel:${limpio(num)}">${contactoIcono("tel", num)}</a><br>`; 
  });
  [negocio.whatsapp3, negocio.whatsapp4].forEach(num => { 
    if(existe(num)) contactoHTML += `<a href="https://wa.me/${limpio(num)}" target="_blank" rel="noopener">${contactoIcono("whatsapp", num)}</a><br>`; 
  });
  if(existe(negocio.facebook2)) contactoHTML += `<a href="https://facebook.com/${negocio.facebook2}" target="_blank">${contactoIcono("facebook", "Facebook")}</a><br>`;
  if(existe(negocio.instagram2)) contactoHTML += `<a href="https://instagram.com/${negocio.instagram2}" target="_blank">${contactoIcono("instagram", "Instagram")}</a><br>`;
  if(existe(negocio.tiktok2)) contactoHTML += `<a href="https://tiktok.com/@${negocio.tiktok2}" target="_blank">${contactoIcono("tiktok", "TikTok")}</a><br>`;
  if(existe(negocio.web2)) contactoHTML += `<a href="${negocio.web2}" target="_blank">${contactoIcono("web", negocio.web_text2 ?? negocio.web2)}</a><br>`;
  if(existe(negocio.web3)) contactoHTML += `<a href="${negocio.web3}" target="_blank">${contactoIcono("web", negocio.web_text3 ?? negocio.web3)}</a><br>`;

  document.getElementById("contacto").innerHTML = contactoHTML;

  // ---------- Horarios ----------
  const horarioCaja = document.getElementById("horario"), bloqueHorario = document.getElementById("bloque-horario");
  let horarioHTML = "";
  if(existe(negocio.horario1)) horarioHTML += `${suc1 ? `<h6 class="mt-2">${negocio.sucursal1}</h6>` : ""}${negocio.horario1}<br>`;
  if(existe(negocio.horario2)) horarioHTML += `${suc2 ? `<h6 class="mt-2">${negocio.sucursal2}</h6>` : ""}${negocio.horario2}<br>`;
  if(!existe(negocio.horario1) && !existe(negocio.horario2)) bloqueHorario.style.display = "none";
  else horarioCaja.innerHTML = horarioHTML;

  // ---------- Menú ----------
  const menuEl = document.getElementById("menu");
  if(menuEl) {
    if(existe(negocio.menu)) { 
      menuEl.href = negocio.menu; 
      menuEl.setAttribute("download", negocio.menu); 
      menuEl.style.display = "inline-block"; 
    }
    else menuEl.style.display = "none";
  }

  // ---------- Mapas ----------
  const mapa1El = document.getElementById("mapa1"), suc1TituloEl = document.getElementById("sucursal1-titulo");
  if(mapa1El) {
    if(existe(negocio.mapa1)) { 
      mapa1El.src = negocio.mapa1; 
      if(suc1TituloEl) suc1TituloEl.textContent = negocio.sucursal1 ?? ""; 
    } else { 
      mapa1El.style.display="none"; 
      if(suc1TituloEl) suc1TituloEl.style.display="none"; 
    }
  }

  const mapa2El = document.getElementById("mapa2"), suc2TituloEl = document.getElementById("sucursal2-titulo");
  if(mapa2El) {
    if(existe(negocio.mapa2)) { 
      mapa2El.src = negocio.mapa2; 
      if(suc2TituloEl) suc2TituloEl.textContent = negocio.sucursal2 ?? ""; 
    } else { 
      mapa2El.style.display="none"; 
      if(suc2TituloEl) suc2TituloEl.style.display="none"; 
    }
  }
}

cargarNegocio();
</script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>